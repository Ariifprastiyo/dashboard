<table class="table table-striped table-hover table-responsive">
  <thead class="table-primary">
    
    <tr>
      <th></th>
      <th><%= sort_link(@q, :social_media_account_username) %></th>
      <th>Size</th>
      <th>Platform</th>
      <th><%= sort_link(@q, :social_media_account_estimated_reach, 'Reach') %></th>
      <th><%= sort_link(@q, :social_media_account_estimated_likes_count, 'Likes') %></th>
      <th><%= sort_link(@q, :social_media_account_estimated_share_count, 'Share') %></th>
      <th><%= sort_link(@q, :social_media_account_estimated_comments_count, 'Comment') %></th>
      <th>Total</th>
      <th><%= sort_link(@q, :social_media_account_estimated_engagement_rate, 'ER%') %></th>
      <% if(current_user.has_any_role?(:admin, :bd)) %><th>Sell Price</th><% end %>
      <th>Notes</th>
      <th>CPV</th>
      <th>CPR</th>
      <th>CPE</th>
      <th>Categories</th>
      <th>Invitation</th>
      <th>SPK</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <% @scope_of_works.each do |sow| %>
      <tr id=<%= dom_id(sow.social_media_account) %>>
        <td class="align-middle"><%= image_tag url_for(sow.social_media_account.profile_picture.variant(:thumb)), class: 'rounded-circle' %></td>
        <td class="align-middle"><%= link_to_social_media_account(sow.social_media_account.username, sow.social_media_account.platform) %>
        <td class="align-middle"><%= sow.social_media_account.size %></td>
        <td class="align-middle"><%= icon_for sow.social_media_account.platform %></td>
        <td class="align-middle"><%= number_with_delimiter sow.social_media_account.estimated_reach.to_i %></td>
        <td class="align-middle"><%= number_with_delimiter sow.social_media_account.estimated_likes_count.to_i %></td>
        <td class="align-middle"><%= number_with_delimiter sow.social_media_account.estimated_share_count.to_i %></td>
        <td class="align-middle"><%= number_with_delimiter sow.social_media_account.estimated_comments_count.to_i %></td>
        <td class="align-middle"><%= number_with_delimiter sow.social_media_account.estimated_total_engagement %></td>
        <td class="align-middle"><%= number_to_percentage sow.social_media_account.estimated_engagement_rate, precision: 2 %></td>
        <% if sow.present? %>
          <% if(current_user.has_any_role?(:admin, :bd)) %>
            <td class="align-middle">
              <%= number_to_currency sow.total_sell_price.to_i %>
            </td>
          <% end %>
          <td class="align-middle">
            <% sow.scope_of_work_items.each do |item| %>
              <% if item.subtotal.to_i != 0 %>
                <%= item.quantity %>x <%= item.name.humanize %>
                <br>
              <% end %>
            <% end %>
          </td>
        <% end %>
        <td class="align-middle"><%= number_to_currency sow.cpv.to_i %></td>
        <td class="align-middle"><%= number_to_currency sow.cpr.to_i %></td>
        <td class="align-middle"><%= number_to_currency sow.cpe.to_i %></td>
        <td class="align-middle">
          <%= badges_for(sow.social_media_account.categories.map { |cat| cat.name }) %>
        </td>
        <td>
          <%= invitation_status_badge sow.status %>
        </td>
        <td>
          <% if sow.agreement_letter.attached? %>
            <%= link_to rails_blob_path(sow.agreement_letter, disposition: "attachment"), target: '_blank' do %>
              <%= icon_for("download") %>
            <% end %> 
          <% end %>
        </td>
        <td class="align-middle">
          <% unless defined?(show_options) && show_options == false %>
            <a class="align-items-center pe-0" href="#" data-bs-toggle="dropdown">
              <%= icon_for("three-dots-vertical") %>
            </a>
            <ul class="dropdown-menu dropdown-menu-end">
              <li>
                <%= link_to edit_media_plan_scope_of_work_path(media_plan_id: media_plan, id: sow, params: { social_media_account_id: sow.social_media_account }), class: "btn btn-danger btn-sm dropdown-item d-flex align-items-center" do %>
                  <%=  icon_for("list-task") %>
                  <span>Edit SOW</span>
                <% end %>
              </li>
              <% if current_user.has_any_role?(:admin, :kol) %>
                <li>
                  <%= button_to media_plan_scope_of_work_path(media_plan_id: media_plan, id: sow), method: :delete, class: "btn btn-danger btn-sm dropdown-item d-flex align-items-center remove-kol", form: { data: { 'turbo-confirm': "Are you sure want to remove #{sow.social_media_account.username}?" } } do %>
                    <%=  icon_for("trash") %>
                    <span>Remove</span>
                  <% end %>
                </li>
                <li>
                  <div data-controller="clipboard" data-clipboard-success-content="Copied!">
                    <input type="hidden" value="<%= sow_invitation_url sow.uuid %>" data-clipboard-target="source" />
                    <button type="button" data-action="clipboard#copy" data-clipboard-target="button" class="btn btn-danger btn-sm dropdown-item d-flex align-items-center">
                      <%=  icon_for("files") %>
                      <span>Copy Invitation</span>
                    </button>
                  </div>
                </li>
                <li>
                  <div>
                    <%= link_to "https://wa.me/#{sow.social_media_account.influencer.phone_number}?text=Halo%20#{sow.social_media_account.influencer.name}, Silahkan Kunjungi #{sow_invitation_url sow.uuid}", target: '_blank', class: "btn btn-danger btn-sm dropdown-item d-flex align-items-center" do %>
                      <%= icon_for("send") %>
                      <span>Send to WA</span>
                    <% end %>
                  </div>
                </li>
                <li>
                  <div data-controller="clipboard" data-clipboard-success-content="Copied!">
                    <input type="hidden" value="<%= employment_agreement_letter_url sow.uuid %>" data-clipboard-target="source" />
                    <button type="button" data-action="clipboard#copy" data-clipboard-target="button" class="btn btn-danger btn-sm dropdown-item d-flex align-items-center">
                      <%=  icon_for("files") %>
                      <span>Copy SPK Url</span>
                    </button>
                  </div>
                </li>
              <% end %>
            </ul>
          <% end %>
        </td>
      </tr>
    <% end %>
  </tbody>
</table>

<%= paginate @scope_of_works, theme: 'bootstrap-5' %>
