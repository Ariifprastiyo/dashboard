<div id="tiktok-info" class="text-center">
  <% unless @social_media_account.present? %>
    <%= form_tag import_social_media_account_google_chrome_ext_popup_index_path, method: :post, id: 'import-form' do %>
      <%= hidden_field_tag :tiktok_username, @tiktok_username %>
      <%= hidden_field_tag :tiktok_video_id, @tiktok_video_id %>
      <%= submit_tag "Import TikTok Account ✨", class: "btn btn-primary", id: 'import-button' %>
    <% end %>
    <div id="loading" style="display: none;">
      <div id="emoji-spinner">🤔</div>
      <p id="loading-text">Importing... Hold tight!</p>
      <p id="fun-text">Decoding TikTok dance moves...</p>
    </div>
  <% end %>

  <% if @social_media_publication.blank? and @social_media_account.present? %>
    <%= link_to "Import TikTok Post 📸", new_post_campaign_google_chrome_ext_popup_index_path(tiktok_username: @tiktok_username, tiktok_video_id: @tiktok_video_id), class: "btn btn-primary mt-3" %>
  <% end %>

  <% if @social_media_publication.present? and @social_media_account.present? %>
    <div class="card mt-3">
      <div class="card-body">
        <h5 class="card-title text-success">
          <i class="fas fa-check-circle mr-2"></i>
          Great news! Everything is set up and ready.
        </h5>
        <ul class="list-group list-group-flush">
          <li class="list-group-item">
            <%= link_to "Go to : #{@social_media_account.influencer.name} page", influencer_path(@social_media_account.influencer), target: "_blank", class: "text-primary" %>
          </li>
          <li class="list-group-item">
            <%= link_to "Go to : #{@social_media_publication.campaign.name} page", campaign_path(@social_media_publication.campaign), target: "_blank", class: "text-primary" %>
          </li>
        </ul>
      </div>
    </div>
  <% end %>

  <div class="mt-3">
    <%= link_to "Go to Dashboard 🤖", root_path, class: "btn btn-primary", target: "_blank" %>
  </div>
</div>

<style>
#emoji-spinner {
  font-size: 40px;
  animation: spin 2s infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

#fun-text {
  font-style: italic;
  color: #6c757d;
}
</style>

<script>
document.getElementById('import-form')?.addEventListener('submit', function(e) {
  const button = document.getElementById('import-button');
  const loading = document.getElementById('loading');
  button.style.display = 'none';
  loading.style.display = 'block';
  
  const emojis = ['🤔', '🧐', '🤨', '🤓', '😎'];
  let index = 0;
  setInterval(() => {
    document.getElementById('emoji-spinner').textContent = emojis[index];
    index = (index + 1) % emojis.length;
  }, 500);
});
</script>
